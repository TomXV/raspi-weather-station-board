var D=[{id:"sapporo",name:"札幌",enName:"Sapporo",zhName:"札幌",koName:"삿포로",region:"北海道",enRegion:"Hokkaido",zhRegion:"北海道",koRegion:"홋카이도",lat:43.0618,lon:141.3545},{id:"sendai",name:"仙台",enName:"Sendai",zhName:"仙台",koName:"센다이",region:"宮城県",enRegion:"Miyagi",zhRegion:"宫城县",koRegion:"미야기현",lat:38.2688,lon:140.8721},{id:"tokyo",name:"東京",enName:"Tokyo",zhName:"东京",koName:"도쿄",region:"東京都",enRegion:"Tokyo",zhRegion:"东京都",koRegion:"도쿄도",lat:35.6762,lon:139.6503},{id:"nagoya",name:"名古屋",enName:"Nagoya",zhName:"名古屋",koName:"나고야",region:"愛知県",enRegion:"Aichi",zhRegion:"爱知县",koRegion:"아이치현",lat:35.1815,lon:136.9066},{id:"osaka",name:"大阪",enName:"Osaka",zhName:"大阪",koName:"오사카",region:"大阪府",enRegion:"Osaka",zhRegion:"大阪府",koRegion:"오사카부",lat:34.6937,lon:135.5023},{id:"fukuoka",name:"福岡",enName:"Fukuoka",zhName:"福冈",koName:"후쿠오카",region:"福岡県",enRegion:"Fukuoka",zhRegion:"福冈县",koRegion:"후쿠오카현",lat:33.5904,lon:130.4017}],G=[{id:"hokushin",name:"長野市",enName:"Nagano",zhName:"长野市",koName:"나가노시",region:"北信",enRegion:"North Shin",zhRegion:"北信",koRegion:"북신",lat:36.6485,lon:138.1948},{id:"toushin",name:"上田市",enName:"Ueda",zhName:"上田市",koName:"우에다시",region:"東信",enRegion:"East Shin",zhRegion:"东信",koRegion:"동신",lat:36.402,lon:138.249},{id:"chushin",name:"松本市",enName:"Matsumoto",zhName:"松本市",koName:"마쓰모토시",region:"中信",enRegion:"Central Shin",zhRegion:"中信",koRegion:"중신",lat:36.238,lon:137.9724},{id:"nanshin",name:"飯田市",enName:"Iida",zhName:"饭田市",koName:"이다시",region:"南信",enRegion:"South Shin",zhRegion:"南信",koRegion:"남신",lat:35.5151,lon:137.8217},{id:"suwa",name:"諏訪市",enName:"Suwa",zhName:"诹访市",koName:"스와시",region:"諏訪エリア",enRegion:"Suwa Area",zhRegion:"诹访区域",koRegion:"스와 지역",lat:36.0392,lon:138.1131},{id:"inaji",name:"伊那市",enName:"Ina",zhName:"伊那市",koName:"이나시",region:"伊那路エリア",enRegion:"Inaji Area",zhRegion:"伊那路区域",koRegion:"이나지 지역",lat:35.8274,lon:137.9537},{id:"kisoj",name:"木曽町",enName:"Kiso",zhName:"木曾町",koName:"기소마치",region:"木曽路エリア",enRegion:"Kisoji Area",zhRegion:"木曾路区域",koRegion:"기소지 지역",lat:35.8423,lon:137.6937},{id:"alps",name:"大町市",enName:"Omachi",zhName:"大町市",koName:"오마치시",region:"日本アルプスエリア",enRegion:"Japan Alps Area",zhRegion:"日本阿尔卑斯区域",koRegion:"일본 알프스 지역",lat:36.5045,lon:137.8518}],C=[{code:"016000",labelJa:"札幌(北海道)",labelEn:"Sapporo (Hokkaido)",labelZh:"札幌（北海道）"},{code:"040000",labelJa:"仙台(宮城県)",labelEn:"Sendai (Miyagi)",labelZh:"仙台（宫城县）"},{code:"130000",labelJa:"東京(東京都)",labelEn:"Tokyo (Tokyo)",labelZh:"东京（东京都）"},{code:"230000",labelJa:"名古屋(愛知県)",labelEn:"Nagoya (Aichi)",labelZh:"名古屋（爱知县）"},{code:"270000",labelJa:"大阪(大阪府)",labelEn:"Osaka (Osaka)",labelZh:"大阪（大阪府）"},{code:"400000",labelJa:"福岡(福岡県)",labelEn:"Fukuoka (Fukuoka)",labelZh:"福冈（福冈县）"},{code:"200000",labelJa:"長野県",labelEn:"Nagano",labelZh:"长野县"}],Q="ja",v={ja:{boardTitle:"⛅ 気象情報ボード",warningTitle:"⚠ 警報・注意報（主要都市 + 長野県 / 生文）",piTitle:"\uD83D\uDDA5 Raspberry Pi ステータス",majorLabel:"▶ 主要都市",naganoLabel:"▶ 長野県",updated:"最終更新",updating:"更新中...",precip:"降水量",wind:"風速",humidity:"湿度",failed:"取得失敗",page:"ページ",nextUpdate:"次回更新まで",calGregorian:"西暦",calJapanese:"和暦",calChinese:"中国暦"},en:{boardTitle:"⛅ Weather Board",warningTitle:"⚠ Warning / Advisory (Major Cities + Nagano / Raw Text)",piTitle:"\uD83D\uDDA5 Raspberry Pi Status",majorLabel:"▶ Major Cities",naganoLabel:"▶ Nagano",updated:"Updated",updating:"Updating...",precip:"Rain",wind:"Wind",humidity:"Humidity",failed:"Fetch Failed",page:"Page",nextUpdate:"Next update in",calGregorian:"Gregorian",calJapanese:"Japanese Era",calChinese:"Chinese Calendar"},zh:{boardTitle:"⛅ 气象信息看板",warningTitle:"⚠ 警报/注意报（主要城市 + 长野 / 原文）",piTitle:"\uD83D\uDDA5 Raspberry Pi 状态",majorLabel:"▶ 主要城市",naganoLabel:"▶ 长野",updated:"更新",updating:"更新中...",precip:"降水",wind:"风速",humidity:"湿度",failed:"获取失败",page:"页",nextUpdate:"距离下次更新",calGregorian:"公历",calJapanese:"和历",calChinese:"农历"},ko:{boardTitle:"⛅ 기상 정보 보드",warningTitle:"⚠ 경보/주의보 (주요 도시 + 나가노 / 원문)",piTitle:"\uD83D\uDDA5 Raspberry Pi 상태",majorLabel:"▶ 주요 도시",naganoLabel:"▶ 나가노",updated:"갱신",updating:"갱신 중...",precip:"강수",wind:"풍속",humidity:"습도",failed:"가져오기 실패",page:"페이지",nextUpdate:"다음 업데이트까지",calGregorian:"서기",calJapanese:"화력",calChinese:"중국력"}};function h(q){return{0:{icon:"☀️",ja:"快晴",en:"Clear",ko:"맑음"},1:{icon:"\uD83C\uDF24️",ja:"ほぼ晴れ",en:"Mostly clear",ko:"대체로 맑음"},2:{icon:"⛅",ja:"一部曇り",en:"Partly cloudy",ko:"부분적으로 흐림"},3:{icon:"☁️",ja:"曇り",en:"Cloudy",ko:"흐림"},45:{icon:"\uD83C\uDF2B️",ja:"霧",en:"Fog",ko:"안개"},48:{icon:"\uD83C\uDF2B️",ja:"霧(着氷)",en:"Rime fog",ko:"착빙 안개"},51:{icon:"\uD83C\uDF26️",ja:"霧雨(弱)",en:"Light drizzle",ko:"약한 이슬비"},53:{icon:"\uD83C\uDF26️",ja:"霧雨",en:"Drizzle",ko:"이슬비"},55:{icon:"\uD83C\uDF26️",ja:"霧雨(強)",en:"Dense drizzle",ko:"강한 이슬비"},61:{icon:"\uD83C\uDF27️",ja:"雨(弱)",en:"Light rain",ko:"약한 비"},63:{icon:"\uD83C\uDF27️",ja:"雨",en:"Rain",ko:"비"},65:{icon:"\uD83C\uDF27️",ja:"雨(強)",en:"Heavy rain",ko:"강한 비"},71:{icon:"\uD83C\uDF28️",ja:"雪(弱)",en:"Light snow",ko:"약한 눈"},73:{icon:"❄️",ja:"雪",en:"Snow",ko:"눈"},75:{icon:"❄️",ja:"雪(強)",en:"Heavy snow",ko:"강한 눈"},77:{icon:"\uD83C\uDF28️",ja:"あられ",en:"Snow grains",ko:"싸락눈"},80:{icon:"\uD83C\uDF26️",ja:"にわか雨(弱)",en:"Light showers",ko:"약한 소나기"},81:{icon:"\uD83C\uDF26️",ja:"にわか雨",en:"Showers",ko:"소나기"},82:{icon:"⛈️",ja:"にわか雨(強)",en:"Heavy showers",ko:"강한 소나기"},85:{icon:"\uD83C\uDF28️",ja:"にわか雪",en:"Snow showers",ko:"눈 소나기"},86:{icon:"\uD83C\uDF28️",ja:"にわか雪(強)",en:"Heavy snow showers",ko:"강한 눈 소나기"},95:{icon:"⛈️",ja:"雷雨",en:"Thunderstorm",ko:"뇌우"},96:{icon:"⛈️",ja:"雷雨+ひょう",en:"Storm + hail",ko:"뇌우+우박"},99:{icon:"⛈️",ja:"激しい雷雨",en:"Severe storm",ko:"강한 뇌우"}}[q]||{icon:"❓",ja:`(${q})`,en:`(${q})`,ko:`(${q})`}}function k(q){let z=Q==="en"?q.enName||q.name:Q==="zh"?q.zhName||q.enName||q.name:Q==="ko"?q.koName||q.enName||q.name:q.name,B=Q==="en"?q.enRegion||q.region:Q==="zh"?q.zhRegion||q.enRegion||q.region:Q==="ko"?q.koRegion||q.enRegion||q.region:q.region;return{name:z,region:B}}function E(){let q=v[Q],z=document.getElementById("board-title");if(z)z.textContent=q.boardTitle;let B=document.getElementById("warning-title");if(B)B.textContent=q.warningTitle;let J=document.getElementById("pi-title");if(J)J.textContent=q.piTitle;let V=document.getElementById("major-label");if(V)V.textContent=q.majorLabel;let K=document.getElementById("nagano-label");if(K)K.textContent=q.naganoLabel;i(new Date)}function A(q){return q.labelJa}function L(q,z){let B=document.createElement("div");B.className="weather-card",B.id=`card-${q.id}`;let J=k(q);return B.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div class="card-city">${J.name}</div>
        <div class="card-region">${J.region}</div>
      </div>
      <div class="loading">…</div>
    </div>
  `,B}var W=4,R=1800000,p=Date.now()+R,H=0,F={};function b(q){let z=document.getElementById("nagano-grid");if(!z)return;let B=Math.ceil(G.length/W);H=(q%B+B)%B;let J=H*W,V=G.slice(J,J+W);z.innerHTML="",V.forEach((Y)=>{if(z.appendChild(L(Y,!0)),F[Y.id])x(Y,F[Y.id])});let K=document.getElementById("nagano-page-indicator");if(K)K.textContent=`(${H+1}/${B})`}function d(){let q=document.getElementById("cities-grid");D.forEach((z)=>q.appendChild(L(z,!1))),b(0)}async function l(q){let z=`https://api.open-meteo.com/v1/forecast?latitude=${q.lat}&longitude=${q.lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&hourly=temperature_2m&past_hours=2&forecast_hours=1&timezone=Asia%2FTokyo&forecast_days=1`,B=await fetch(z);if(!B.ok)throw Error(B.status);return B.json()}function P(q,z){let B=document.getElementById(q);if(!B)return;let J=(z||"").trim()||"情報なし";B.textContent=`${J}　◆　${J}　◆　`;let V=Math.max(24,Math.min(90,Math.round(J.length*0.45)));B.style.animationDuration=`${V}s`}function o(){let q=D.map((z)=>{let B=F[z.id];if(!B||!B.current||!B.daily)return`${z.name}: --`;let{desc:J}=h(B.current.weather_code),V=Math.round(B.current.temperature_2m),K=B.daily.precipitation_probability_max?.[0]??"--";return`${z.name} ${V}°C ${J} 降水${K}%`});P("city-track",q.join(" ｜ "))}async function S(){try{let z=(await Promise.allSettled(C.map(async(B)=>{let J=await fetch(`https://www.jma.go.jp/bosai/warning/data/warning/${B.code}.json`);if(!J.ok)throw Error(String(J.status));let V=await J.json(),K=(V.headlineText||"").trim(),Y=(V.reportDatetime||"").replace("T"," ").replace("+09:00",""),j=A(B);if(!K)return`${j}: 現在、目立つ警報見出しなし`;return`${j} [${Y}] ${K}`}))).map((B,J)=>{if(B.status==="fulfilled")return B.value;return`${A(C[J])}: 取得失敗`});P("alert-track",z.join(" ｜ "))}catch(q){P("alert-track","警報・注意報情報の取得に失敗")}}async function f(){try{let q=await fetch("/api/pi-status");if(!q.ok)throw Error("status");let z=await q.json(),B=z.mem?`${z.mem.used_gb}/${z.mem.total_gb}GB (${z.mem.used_pct}%)`:"--",J=z.disk?`${z.disk.used_gb}/${z.disk.total_gb}GB (${z.disk.used_pct}%)`:"--",V=z.cpu_temp_c??"--",K=z.load1??"--",Y=z.uptime||"--",j=z.ip||"--",$=Q==="en"?{temp:"Temp",load:"Load",mem:"Memory",disk:"Disk",up:"Uptime",ip:"IP"}:Q==="zh"?{temp:"温度",load:"负载",mem:"内存",disk:"磁盘",up:"运行时长",ip:"IP"}:Q==="ko"?{temp:"온도",load:"부하",mem:"메모리",disk:"디스크",up:"가동시간",ip:"IP"}:{temp:"温度",load:"負荷",mem:"メモリ",disk:"ディスク",up:"稼働",ip:"IP"};document.getElementById("pi-status").innerHTML=`
      <span>${$.temp}: <b>${V}°C</b></span>
      <span>${$.load}: <b>${K}</b></span>
      <span>${$.mem}: <b>${B}</b></span>
      <span>${$.disk}: <b>${J}</b></span>
      <span>${$.up}: <b>${Y}</b></span>
      <span>${$.ip}: <b>${j}</b></span>
    `}catch(q){document.getElementById("pi-status").innerHTML=`<span>${v[Q].failed}</span>`}}function r(q){if(q>=1.5)return{symbol:"↑",cls:"up-fast"};if(q>=0.5)return{symbol:"↗",cls:"up"};if(q<=-1.5)return{symbol:"↓",cls:"down-fast"};if(q<=-0.5)return{symbol:"↘",cls:"down"};return{symbol:"→",cls:"flat"}}function t(q){let z=Number(q?.current?.temperature_2m),B=q?.hourly?.time||[],J=q?.hourly?.temperature_2m||[];if(!Number.isFinite(z)||!Array.isArray(B)||!Array.isArray(J)||B.length===0)return 0;let V=Date.now()-1800000,K=-1,Y=1/0;for(let j=0;j<B.length;j++){let $=new Date(B[j]).getTime();if(!Number.isFinite($))continue;let Z=Math.abs($-V);if(Z<Y)Y=Z,K=j}if(K<0||!Number.isFinite(Number(J[K])))return 0;return z-Number(J[K])}function x(q,z){let B=document.getElementById(`card-${q.id}`);if(!B)return;let{current:J,daily:V}=z,K=h(J.weather_code),Y=Q==="en"?K.en:Q==="zh"?K.zh||K.en:Q==="ko"?K.ko||K.en:K.ja,j=Math.round(V.temperature_2m_max[0]),$=Math.round(V.temperature_2m_min[0]),Z=V.precipitation_probability_max[0]??"--",M=k(q),X=v[Q],O=r(t(z));B.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div class="card-city">${M.name}</div>
        <div class="card-region">${M.region}</div>
      </div>
      <div class="card-precip">${X.precip}:${Z}%</div>
    </div>
    <div class="card-weather-row">
      <span class="card-icon">${K.icon}</span>
      <div>
        <div>
          <span class="card-temp">${Math.round(J.temperature_2m)}</span>
          <span class="card-temp-unit">°C</span>
          <span class="card-trend ${O.cls}">${O.symbol}</span>
        </div>
        <div class="card-desc">${Y}</div>
      </div>
    </div>
    <div class="card-minmax">
      <span class="max">↑${j}°</span>
      &nbsp;
      <span class="min">↓${$}°</span>
    </div>
    <div class="card-details">
      <span class="card-detail">\uD83D\uDCA8 ${X.wind} ${Math.round(J.wind_speed_10m)}km/h</span>
      <span class="card-detail">\uD83D\uDCA7 ${X.humidity} ${J.relative_humidity_2m}%</span>
    </div>
  `,B.classList.add("loaded")}function c(q,z){let B=document.getElementById(`card-${q.id}`);if(!B)return;let J=k(q);B.innerHTML=`
    <div class="card-city">${J.name}</div>
    <div class="card-region">${J.region}</div>
    <div class="error">${v[Q].failed}</div>
  `}async function w(){document.getElementById("last-updated").textContent=`${v[Q].updating}`;let q=[...D,...G];await Promise.allSettled(q.map(async(B)=>{try{let J=await l(B);F[B.id]=J,x(B,J)}catch(J){c(B,J.message)}})),o();let z=new Date;p=z.getTime()+R,document.getElementById("last-updated").textContent=`${v[Q].updated}: ${z.getHours().toString().padStart(2,"0")}:${z.getMinutes().toString().padStart(2,"0")}`}function n(q,z){try{if(z==="gregory")return`${q.getFullYear()}/${String(q.getMonth()+1).padStart(2,"0")}/${String(q.getDate()).padStart(2,"0")}`;if(z==="japanese")return new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{year:"numeric",month:"2-digit",day:"2-digit"}).format(q);return new Intl.DateTimeFormat("zh-CN-u-ca-chinese",{year:"numeric",month:"long",day:"numeric"}).format(q)}catch{return`${q.getFullYear()}/${String(q.getMonth()+1).padStart(2,"0")}/${String(q.getDate()).padStart(2,"0")}`}}function i(q){let z=Math.max(0,p-q.getTime()),B=String(Math.floor(z/60000)).padStart(2,"0"),J=String(Math.floor(z%60000/1000)).padStart(2,"0"),V=document.getElementById("next-update");if(V)V.textContent=`${v[Q].nextUpdate} ${B}:${J}`}function e(q){let z=Math.floor(q.getTime()/6000);if(Q==="zh")return["gregory","japanese","chinese"][z%3];return["gregory","japanese"][z%2]}function u(){let q=new Date,z=q.getHours(),B=z.toString().padStart(2,"0"),J=q.getMinutes().toString().padStart(2,"0"),V=q.getSeconds().toString().padStart(2,"0");document.getElementById("clock").textContent=`${B}:${J}:${V}`;let K=(z+11)%12+1,Y=z<12,j=Q==="en"?`${Y?"AM":"PM"} ${K}:00`:Q==="zh"?`${Y?"上午":"下午"}${K}点`:Q==="ko"?`${Y?"오전":"오후"} ${K}시`:`${Y?"午前":"午後"}${K}時`,$=document.getElementById("clock12-str");if($)$.textContent=j;let Z=["日","月","火","水","木","金","土"],M=q.getFullYear(),X=(q.getMonth()+1).toString().padStart(2,"0"),O=q.getDate().toString().padStart(2,"0"),s=Z[q.getDay()],N=document.getElementById("weekday-str");if(N){let g=Q==="en"?["SUN","MON","TUE","WED","THU","FRI","SAT"][q.getDay()]:Q==="zh"?["周日","周一","周二","周三","周四","周五","周六"][q.getDay()]:Q==="ko"?["일","월","화","수","목","금","토"][q.getDay()]:`${s}曜`;N.textContent=g}let _=e(q),U=document.getElementById("date-str");if(U)U.textContent=n(q,_),U.classList.toggle("is-chinese-cal",_==="chinese");i(q)}var I;function a(){document.body.classList.remove("cursor-hidden"),clearTimeout(I),I=setTimeout(()=>{document.body.classList.add("cursor-hidden")},3000)}["mousemove","mousedown","wheel","touchstart","keydown"].forEach((q)=>{window.addEventListener(q,a,{passive:!0})});var T=["ja","en","zh","ko"],y=0;function qq(q){if(q===Q)return;Q=q,E(),D.forEach((B)=>{if(F[B.id])x(B,F[B.id])}),b(H),S(),f();let z=new Date;document.getElementById("last-updated").textContent=`${v[Q].updated}: ${z.getHours().toString().padStart(2,"0")}:${z.getMinutes().toString().padStart(2,"0")}`}function zq(){y=(y+1)%T.length,qq(T[y])}E();d();u();setInterval(u,1000);w();S();f();document.body.classList.add("cursor-hidden");setInterval(w,R);setInterval(S,600000);setInterval(f,60000);var m=0;setInterval(()=>{if(b(H+1),m++,m%2===0)zq()},12000);
