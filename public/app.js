var D=[{id:"sapporo",name:"札幌",enName:"Sapporo",region:"北海道",enRegion:"Hokkaido",lat:43.0618,lon:141.3545},{id:"sendai",name:"仙台",enName:"Sendai",region:"宮城県",enRegion:"Miyagi",lat:38.2688,lon:140.8721},{id:"tokyo",name:"東京",enName:"Tokyo",region:"東京都",enRegion:"Tokyo",lat:35.6762,lon:139.6503},{id:"nagoya",name:"名古屋",enName:"Nagoya",region:"愛知県",enRegion:"Aichi",lat:35.1815,lon:136.9066},{id:"osaka",name:"大阪",enName:"Osaka",region:"大阪府",enRegion:"Osaka",lat:34.6937,lon:135.5023},{id:"fukuoka",name:"福岡",enName:"Fukuoka",region:"福岡県",enRegion:"Fukuoka",lat:33.5904,lon:130.4017}],R=[{id:"hokushin",name:"長野市",enName:"Nagano",region:"北信",enRegion:"North Shin",lat:36.6485,lon:138.1948},{id:"toushin",name:"上田市",enName:"Ueda",region:"東信",enRegion:"East Shin",lat:36.402,lon:138.249},{id:"chushin",name:"松本市",enName:"Matsumoto",region:"中信",enRegion:"Central Shin",lat:36.238,lon:137.9724},{id:"nanshin",name:"飯田市",enName:"Iida",region:"南信",enRegion:"South Shin",lat:35.5151,lon:137.8217},{id:"suwa",name:"諏訪市",enName:"Suwa",region:"諏訪エリア",enRegion:"Suwa Area",lat:36.0392,lon:138.1131},{id:"inaji",name:"伊那市",enName:"Ina",region:"伊那路エリア",enRegion:"Inaji Area",lat:35.8274,lon:137.9537},{id:"kisoj",name:"木曽町",enName:"Kiso",region:"木曽路エリア",enRegion:"Kisoji Area",lat:35.8423,lon:137.6937},{id:"alps",name:"大町市",enName:"Omachi",region:"日本アルプスエリア",enRegion:"Japan Alps Area",lat:36.5045,lon:137.8518}],f=[{label:"札幌(北海道)",code:"016000"},{label:"仙台(宮城県)",code:"040000"},{label:"東京(東京都)",code:"130000"},{label:"名古屋(愛知県)",code:"230000"},{label:"大阪(大阪府)",code:"270000"},{label:"福岡(福岡県)",code:"400000"},{label:"長野県",code:"200000"}],Q="ja",$={ja:{boardTitle:"⛅ 気象情報ボード",warningTitle:"⚠ 警報・注意報（主要都市 + 長野県 / 生文）",piTitle:"\uD83D\uDDA5 Raspberry Pi ステータス",majorLabel:"▶ 主要都市",naganoLabel:"▶ 長野県",updated:"最終更新",updating:"更新中...",precip:"降水量",wind:"風速",humidity:"湿度",failed:"取得失敗",page:"ページ"},en:{boardTitle:"⛅ Weather Board",warningTitle:"⚠ Warning / Advisory (Major Cities + Nagano / Raw Text)",piTitle:"\uD83D\uDDA5 Raspberry Pi Status",majorLabel:"▶ Major Cities",naganoLabel:"▶ Nagano",updated:"Updated",updating:"Updating...",precip:"Rain",wind:"Wind",humidity:"Humidity",failed:"Fetch Failed",page:"Page"}};function y(q){return{0:{icon:"☀️",ja:"快晴",en:"Clear"},1:{icon:"\uD83C\uDF24️",ja:"ほぼ晴れ",en:"Mostly clear"},2:{icon:"⛅",ja:"一部曇り",en:"Partly cloudy"},3:{icon:"☁️",ja:"曇り",en:"Cloudy"},45:{icon:"\uD83C\uDF2B️",ja:"霧",en:"Fog"},48:{icon:"\uD83C\uDF2B️",ja:"霧(着氷)",en:"Rime fog"},51:{icon:"\uD83C\uDF26️",ja:"霧雨(弱)",en:"Light drizzle"},53:{icon:"\uD83C\uDF26️",ja:"霧雨",en:"Drizzle"},55:{icon:"\uD83C\uDF26️",ja:"霧雨(強)",en:"Dense drizzle"},61:{icon:"\uD83C\uDF27️",ja:"雨(弱)",en:"Light rain"},63:{icon:"\uD83C\uDF27️",ja:"雨",en:"Rain"},65:{icon:"\uD83C\uDF27️",ja:"雨(強)",en:"Heavy rain"},71:{icon:"\uD83C\uDF28️",ja:"雪(弱)",en:"Light snow"},73:{icon:"❄️",ja:"雪",en:"Snow"},75:{icon:"❄️",ja:"雪(強)",en:"Heavy snow"},77:{icon:"\uD83C\uDF28️",ja:"あられ",en:"Snow grains"},80:{icon:"\uD83C\uDF26️",ja:"にわか雨(弱)",en:"Light showers"},81:{icon:"\uD83C\uDF26️",ja:"にわか雨",en:"Showers"},82:{icon:"⛈️",ja:"にわか雨(強)",en:"Heavy showers"},85:{icon:"\uD83C\uDF28️",ja:"にわか雪",en:"Snow showers"},86:{icon:"\uD83C\uDF28️",ja:"にわか雪(強)",en:"Heavy snow showers"},95:{icon:"⛈️",ja:"雷雨",en:"Thunderstorm"},96:{icon:"⛈️",ja:"雷雨+ひょう",en:"Storm + hail"},99:{icon:"⛈️",ja:"激しい雷雨",en:"Severe storm"}}[q]||{icon:"❓",ja:`(${q})`,en:`(${q})`}}function W(q){return{name:Q==="en"?q.enName||q.name:q.name,region:Q==="en"?q.enRegion||q.region:q.region}}function G(){let q=$[Q],B=document.getElementById("board-title");if(B)B.textContent=q.boardTitle;let z=document.getElementById("warning-title");if(z)z.textContent=q.warningTitle;let F=document.getElementById("pi-title");if(F)F.textContent=q.piTitle;let J=document.getElementById("major-label");if(J)J.textContent=q.majorLabel;let K=document.getElementById("nagano-label");if(K)K.textContent=q.naganoLabel}function m(q,B){let z=document.createElement("div");z.className="weather-card",z.id=`card-${q.id}`;let F=W(q);return z.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div class="card-city">${F.name}</div>
        <div class="card-region">${F.region}</div>
      </div>
      <div class="loading">…</div>
    </div>
  `,z}var M=4,H=0,j={};function X(q){let B=document.getElementById("nagano-grid");if(!B)return;let z=Math.ceil(R.length/M);H=(q%z+z)%z;let F=H*M,J=R.slice(F,F+M);B.innerHTML="",J.forEach((V)=>{if(B.appendChild(m(V,!0)),j[V.id])O(V,j[V.id])});let K=document.getElementById("nagano-page-indicator");if(K)K.textContent=`(${H+1}/${z})`}function N(){let q=document.getElementById("cities-grid");D.forEach((B)=>q.appendChild(m(B,!1))),X(0)}async function E(q){let B=`https://api.open-meteo.com/v1/forecast?latitude=${q.lat}&longitude=${q.lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo&forecast_days=1`,z=await fetch(B);if(!z.ok)throw Error(z.status);return z.json()}function U(q,B){let z=document.getElementById(q);if(!z)return;let F=(B||"").trim()||"情報なし";z.textContent=`${F}　◆　${F}　◆　`;let J=Math.max(24,Math.min(90,Math.round(F.length*0.45)));z.style.animationDuration=`${J}s`}function A(){let q=D.map((B)=>{let z=j[B.id];if(!z||!z.current||!z.daily)return`${B.name}: --`;let{desc:F}=y(z.current.weather_code),J=Math.round(z.current.temperature_2m),K=z.daily.precipitation_probability_max?.[0]??"--";return`${B.name} ${J}°C ${F} 降水${K}%`});U("city-track",q.join(" ｜ "))}async function P(){try{let B=(await Promise.allSettled(f.map(async(z)=>{let F=await fetch(`https://www.jma.go.jp/bosai/warning/data/warning/${z.code}.json`);if(!F.ok)throw Error(String(F.status));let J=await F.json(),K=(J.headlineText||"").trim(),V=(J.reportDatetime||"").replace("T"," ").replace("+09:00","");if(!K)return`${z.label}: 現在、目立つ警報見出しなし`;return`${z.label} [${V}] ${K}`}))).map((z,F)=>{if(z.status==="fulfilled")return z.value;return`${f[F].label}: 取得失敗`});U("alert-track",B.join(" ｜ "))}catch(q){U("alert-track","警報・注意報情報の取得に失敗")}}async function x(){try{let q=await fetch("/api/pi-status");if(!q.ok)throw Error("status");let B=await q.json(),z=B.mem?`${B.mem.used_gb}/${B.mem.total_gb}GB (${B.mem.used_pct}%)`:"--",F=B.disk?`${B.disk.used_gb}/${B.disk.total_gb}GB (${B.disk.used_pct}%)`:"--",J=B.cpu_temp_c??"--",K=B.load1??"--",V=B.uptime||"--",v=B.ip||"--",Y=Q==="en"?{temp:"Temp",load:"Load",mem:"Memory",disk:"Disk",up:"Uptime",ip:"IP"}:{temp:"温度",load:"負荷",mem:"メモリ",disk:"ディスク",up:"稼働",ip:"IP"};document.getElementById("pi-status").innerHTML=`
      <span>${Y.temp}: <b>${J}°C</b></span>
      <span>${Y.load}: <b>${K}</b></span>
      <span>${Y.mem}: <b>${z}</b></span>
      <span>${Y.disk}: <b>${F}</b></span>
      <span>${Y.up}: <b>${V}</b></span>
      <span>${Y.ip}: <b>${v}</b></span>
    `}catch(q){document.getElementById("pi-status").innerHTML=`<span>${$[Q].failed}</span>`}}function O(q,B){let z=document.getElementById(`card-${q.id}`);if(!z)return;let{current:F,daily:J}=B,K=y(F.weather_code),V=Q==="en"?K.en:K.ja,v=Math.round(J.temperature_2m_max[0]),Y=Math.round(J.temperature_2m_min[0]),L=J.precipitation_probability_max[0]??"--",b=W(q),Z=$[Q];z.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div class="card-city">${b.name}</div>
        <div class="card-region">${b.region}</div>
      </div>
      <div class="card-precip">${Z.precip}:${L}%</div>
    </div>
    <div class="card-weather-row">
      <span class="card-icon">${K.icon}</span>
      <div>
        <div>
          <span class="card-temp">${Math.round(F.temperature_2m)}</span>
          <span class="card-temp-unit">°C</span>
        </div>
        <div class="card-desc">${V}</div>
      </div>
    </div>
    <div class="card-minmax">
      <span class="max">↑${v}°</span>
      &nbsp;
      <span class="min">↓${Y}°</span>
    </div>
    <div class="card-details">
      <span class="card-detail">\uD83D\uDCA8 ${Z.wind} ${Math.round(F.wind_speed_10m)}km/h</span>
      <span class="card-detail">\uD83D\uDCA7 ${Z.humidity} ${F.relative_humidity_2m}%</span>
    </div>
  `,z.classList.add("loaded")}function C(q,B){let z=document.getElementById(`card-${q.id}`);if(!z)return;let F=W(q);z.innerHTML=`
    <div class="card-city">${F.name}</div>
    <div class="card-region">${F.region}</div>
    <div class="error">${$[Q].failed}</div>
  `}async function S(){document.getElementById("last-updated").textContent=`${$[Q].updating}`;let q=[...D,...R];await Promise.allSettled(q.map(async(z)=>{try{let F=await E(z);j[z.id]=F,O(z,F)}catch(F){C(z,F.message)}})),A();let B=new Date;document.getElementById("last-updated").textContent=`${$[Q].updated}: ${B.getHours().toString().padStart(2,"0")}:${B.getMinutes().toString().padStart(2,"0")}`}function _(){let q=new Date,B=q.getHours().toString().padStart(2,"0"),z=q.getMinutes().toString().padStart(2,"0"),F=q.getSeconds().toString().padStart(2,"0");document.getElementById("clock").textContent=`${B}:${z}:${F}`;let J=["日","月","火","水","木","金","土"],K=q.getFullYear(),V=(q.getMonth()+1).toString().padStart(2,"0"),v=q.getDate().toString().padStart(2,"0"),Y=J[q.getDay()];document.getElementById("date-str").textContent=`${K}/${V}/${v} (${Y})`}var k;function w(){document.body.classList.remove("cursor-hidden"),clearTimeout(k),k=setTimeout(()=>{document.body.classList.add("cursor-hidden")},3000)}["mousemove","mousedown","wheel","touchstart","keydown"].forEach((q)=>{window.addEventListener(q,w,{passive:!0})});function h(){Q=Q==="ja"?"en":"ja",G(),D.forEach((B)=>{if(j[B.id])O(B,j[B.id])}),X(H),x();let q=new Date;document.getElementById("last-updated").textContent=`${$[Q].updated}: ${q.getHours().toString().padStart(2,"0")}:${q.getMinutes().toString().padStart(2,"0")}`}G();N();_();setInterval(_,1000);S();P();x();document.body.classList.add("cursor-hidden");setInterval(S,1800000);setInterval(P,600000);setInterval(x,60000);setInterval(()=>X(H+1),12000);setInterval(h,24000);
