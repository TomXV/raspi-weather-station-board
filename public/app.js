var d={ui:{ja:{boardTitle:"‚õÖ Ê∞óË±°ÊÉÖÂ†±„Éú„Éº„Éâ",warningTitle:"‚ö† Ë≠¶Â†±„ÉªÊ≥®ÊÑèÂ†±Ôºà‰∏ªË¶ÅÈÉΩÂ∏Ç + Èï∑ÈáéÁúå / ÁîüÊñáÔºâ",piTitle:"üñ• Raspberry Pi „Çπ„ÉÜ„Éº„Çø„Çπ",majorLabel:"‚ñ∂ ‰∏ªË¶ÅÈÉΩÂ∏Ç",naganoLabel:"‚ñ∂ Èï∑ÈáéÁúå",updated:"ÊúÄÁµÇÊõ¥Êñ∞",updating:"Êõ¥Êñ∞‰∏≠...",precip:"ÈôçÊ∞¥Èáè",wind:"È¢®ÈÄü",humidity:"ÊπøÂ∫¶",failed:"ÂèñÂæóÂ§±Êïó",page:"„Éö„Éº„Ç∏",nextUpdate:"Ê¨°ÂõûÊõ¥Êñ∞„Åæ„Åß",am:"ÂçàÂâç",pm:"ÂçàÂæå",hourUnit:"ÊôÇ",weekdays:["Êó•Êõú","ÊúàÊõú","ÁÅ´Êõú","Ê∞¥Êõú","Êú®Êõú","ÈáëÊõú","ÂúüÊõú"],piTemp:"Ê∏©Â∫¶",piLoad:"Ë≤†Ëç∑",piMem:"„É°„É¢„É™",piDisk:"„Éá„Ç£„Çπ„ÇØ",piUptime:"Á®ºÂÉç",piIp:"IP",warningNoHeadline:"ÁèæÂú®„ÄÅÁõÆÁ´ã„Å§Ë≠¶Â†±Ë¶ãÂá∫„Åó„Å™„Åó",warningFetchFailed:"ÂèñÂæóÂ§±Êïó",warningAllFailed:"Ë≠¶Â†±„ÉªÊ≥®ÊÑèÂ†±ÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó",noInfo:"ÊÉÖÂ†±„Å™„Åó"},en:{boardTitle:"‚õÖ Weather Board",warningTitle:"‚ö† Warning / Advisory (Major Cities + Nagano / Raw Text)",piTitle:"üñ• Raspberry Pi Status",majorLabel:"‚ñ∂ Major Cities",naganoLabel:"‚ñ∂ Nagano",updated:"Updated",updating:"Updating...",precip:"Rain",wind:"Wind",humidity:"Humidity",failed:"Fetch Failed",page:"Page",nextUpdate:"Next update in",am:"AM",pm:"PM",hourUnit:"",weekdays:["SUN","MON","TUE","WED","THU","FRI","SAT"],piTemp:"Temp",piLoad:"Load",piMem:"Memory",piDisk:"Disk",piUptime:"Uptime",piIp:"IP",warningNoHeadline:"No notable warnings",warningFetchFailed:"Fetch failed",warningAllFailed:"Failed to fetch warning info",noInfo:"No data"},zh:{boardTitle:"‚õÖ Ê∞îË±°‰ø°ÊÅØÁúãÊùø",warningTitle:"‚ö† Ë≠¶Êä•/Ê≥®ÊÑèÊä•Ôºà‰∏ªË¶ÅÂüéÂ∏Ç + ÈïøÈáé / ÂéüÊñáÔºâ",piTitle:"üñ• Raspberry Pi Áä∂ÊÄÅ",majorLabel:"‚ñ∂ ‰∏ªË¶ÅÂüéÂ∏Ç",naganoLabel:"‚ñ∂ ÈïøÈáé",updated:"Êõ¥Êñ∞",updating:"Êõ¥Êñ∞‰∏≠...",precip:"ÈôçÊ∞¥",wind:"È£éÈÄü",humidity:"ÊπøÂ∫¶",failed:"Ëé∑ÂèñÂ§±Ë¥•",page:"È°µ",nextUpdate:"Ë∑ùÁ¶ª‰∏ãÊ¨°Êõ¥Êñ∞",am:"‰∏äÂçà",pm:"‰∏ãÂçà",hourUnit:"ÁÇπ",weekdays:["Âë®Êó•","Âë®‰∏Ä","Âë®‰∫å","Âë®‰∏â","Âë®Âõõ","Âë®‰∫î","Âë®ÂÖ≠"],piTemp:"Ê∏©Â∫¶",piLoad:"Ë¥üËΩΩ",piMem:"ÂÜÖÂ≠ò",piDisk:"Á£ÅÁõò",piUptime:"ËøêË°åÊó∂Èïø",piIp:"IP",warningNoHeadline:"ÊöÇÊó†ÊòéÊòæÈ¢ÑË≠¶‰ø°ÊÅØ",warningFetchFailed:"Ëé∑ÂèñÂ§±Ë¥•",warningAllFailed:"Ëé∑ÂèñÈ¢ÑË≠¶‰ø°ÊÅØÂ§±Ë¥•",noInfo:"Êó†‰ø°ÊÅØ"},ko:{boardTitle:"‚õÖ Í∏∞ÏÉÅ Ï†ïÎ≥¥ Î≥¥Îìú",warningTitle:"‚ö† Í≤ΩÎ≥¥/Ï£ºÏùòÎ≥¥ (Ï£ºÏöî ÎèÑÏãú + ÎÇòÍ∞ÄÎÖ∏ / ÏõêÎ¨∏)",piTitle:"üñ• Raspberry Pi ÏÉÅÌÉú",majorLabel:"‚ñ∂ Ï£ºÏöî ÎèÑÏãú",naganoLabel:"‚ñ∂ ÎÇòÍ∞ÄÎÖ∏",updated:"Í∞±Ïã†",updating:"Í∞±Ïã† Ï§ë...",precip:"Í∞ïÏàò",wind:"ÌíçÏÜç",humidity:"ÏäµÎèÑ",failed:"Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®",page:"ÌéòÏù¥ÏßÄ",nextUpdate:"Îã§Ïùå ÏóÖÎç∞Ïù¥Ìä∏ÍπåÏßÄ",am:"Ïò§Ï†Ñ",pm:"Ïò§ÌõÑ",hourUnit:"Ïãú",weekdays:["Ïùº","Ïõî","Ìôî","Ïàò","Î™©","Í∏à","ÌÜ†"],piTemp:"Ïò®ÎèÑ",piLoad:"Î∂ÄÌïò",piMem:"Î©îÎ™®Î¶¨",piDisk:"ÎîîÏä§ÌÅ¨",piUptime:"Í∞ÄÎèôÏãúÍ∞Ñ",piIp:"IP",warningNoHeadline:"ÌòÑÏû¨ Ï£ºÎ™©Ìï† Í≤ΩÎ≥¥ ÏóÜÏùå",warningFetchFailed:"Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®",warningAllFailed:"Í≤ΩÎ≥¥ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®",noInfo:"Ï†ïÎ≥¥ ÏóÜÏùå"}},cities:[{id:"sapporo",lat:43.0618,lon:141.3545,name_ja:"Êú≠Âπå",name_en:"Sapporo",name_zh:"Êú≠Âπå",name_ko:"ÏÇøÌè¨Î°ú",region_ja:"ÂåóÊµ∑ÈÅì",region_en:"Hokkaido",region_zh:"ÂåóÊµ∑ÈÅì",region_ko:"ÌôãÏπ¥Ïù¥ÎèÑ"},{id:"sendai",lat:38.2688,lon:140.8721,name_ja:"‰ªôÂè∞",name_en:"Sendai",name_zh:"‰ªôÂè∞",name_ko:"ÏÑºÎã§Ïù¥",region_ja:"ÂÆÆÂüéÁúå",region_en:"Miyagi",region_zh:"ÂÆ´ÂüéÂéø",region_ko:"ÎØ∏ÏïºÍ∏∞ÌòÑ"},{id:"tokyo",lat:35.6762,lon:139.6503,name_ja:"Êù±‰∫¨",name_en:"Tokyo",name_zh:"‰∏ú‰∫¨",name_ko:"ÎèÑÏøÑ",region_ja:"Êù±‰∫¨ÈÉΩ",region_en:"Tokyo",region_zh:"‰∏ú‰∫¨ÈÉΩ",region_ko:"ÎèÑÏøÑÎèÑ"},{id:"nagoya",lat:35.1815,lon:136.9066,name_ja:"ÂêçÂè§Â±ã",name_en:"Nagoya",name_zh:"ÂêçÂè§Â±ã",name_ko:"ÎÇòÍ≥†Ïïº",region_ja:"ÊÑõÁü•Áúå",region_en:"Aichi",region_zh:"Áà±Áü•Âéø",region_ko:"ÏïÑÏù¥ÏπòÌòÑ"},{id:"osaka",lat:34.6937,lon:135.5023,name_ja:"Â§ßÈò™",name_en:"Osaka",name_zh:"Â§ßÈò™",name_ko:"Ïò§ÏÇ¨Ïπ¥",region_ja:"Â§ßÈò™Â∫ú",region_en:"Osaka",region_zh:"Â§ßÈò™Â∫ú",region_ko:"Ïò§ÏÇ¨Ïπ¥Î∂Ä"},{id:"fukuoka",lat:33.5904,lon:130.4017,name_ja:"Á¶èÂ≤°",name_en:"Fukuoka",name_zh:"Á¶èÂÜà",name_ko:"ÌõÑÏø†Ïò§Ïπ¥",region_ja:"Á¶èÂ≤°Áúå",region_en:"Fukuoka",region_zh:"Á¶èÂÜàÂéø",region_ko:"ÌõÑÏø†Ïò§Ïπ¥ÌòÑ"}],nagano:[{id:"hokushin",lat:36.6485,lon:138.1948,name_ja:"Èï∑ÈáéÂ∏Ç",name_en:"Nagano",name_zh:"ÈïøÈáéÂ∏Ç",name_ko:"ÎÇòÍ∞ÄÎÖ∏Ïãú",region_ja:"Âåó‰ø°",region_en:"North Shin",region_zh:"Âåó‰ø°",region_ko:"Î∂ÅÏã†"},{id:"toushin",lat:36.402,lon:138.249,name_ja:"‰∏äÁî∞Â∏Ç",name_en:"Ueda",name_zh:"‰∏äÁî∞Â∏Ç",name_ko:"Ïö∞ÏóêÎã§Ïãú",region_ja:"Êù±‰ø°",region_en:"East Shin",region_zh:"‰∏ú‰ø°",region_ko:"ÎèôÏã†"},{id:"chushin",lat:36.238,lon:137.9724,name_ja:"ÊùæÊú¨Â∏Ç",name_en:"Matsumoto",name_zh:"ÊùæÊú¨Â∏Ç",name_ko:"ÎßàÏì∞Î™®ÌÜ†Ïãú",region_ja:"‰∏≠‰ø°",region_en:"Central Shin",region_zh:"‰∏≠‰ø°",region_ko:"Ï§ëÏã†"},{id:"nanshin",lat:35.5151,lon:137.8217,name_ja:"È£ØÁî∞Â∏Ç",name_en:"Iida",name_zh:"È•≠Áî∞Â∏Ç",name_ko:"Ïù¥Îã§Ïãú",region_ja:"Âçó‰ø°",region_en:"South Shin",region_zh:"Âçó‰ø°",region_ko:"ÎÇ®Ïã†"},{id:"suwa",lat:36.0392,lon:138.1131,name_ja:"Ë´èË®™Â∏Ç",name_en:"Suwa",name_zh:"ËØπËÆøÂ∏Ç",name_ko:"Ïä§ÏôÄÏãú",region_ja:"Ë´èË®™„Ç®„É™„Ç¢",region_en:"Suwa Area",region_zh:"ËØπËÆøÂå∫Âüü",region_ko:"Ïä§ÏôÄ ÏßÄÏó≠"},{id:"inaji",lat:35.8274,lon:137.9537,name_ja:"‰ºäÈÇ£Â∏Ç",name_en:"Ina",name_zh:"‰ºäÈÇ£Â∏Ç",name_ko:"Ïù¥ÎÇòÏãú",region_ja:"‰ºäÈÇ£Ë∑Ø„Ç®„É™„Ç¢",region_en:"Inaji Area",region_zh:"‰ºäÈÇ£Ë∑ØÂå∫Âüü",region_ko:"Ïù¥ÎÇòÏßÄ ÏßÄÏó≠"},{id:"kisoj",lat:35.8423,lon:137.6937,name_ja:"Êú®ÊõΩÁî∫",name_en:"Kiso",name_zh:"Êú®ÊõæÁî∫",name_ko:"Í∏∞ÏÜåÎßàÏπò",region_ja:"Êú®ÊõΩË∑Ø„Ç®„É™„Ç¢",region_en:"Kisoji Area",region_zh:"Êú®ÊõæË∑ØÂå∫Âüü",region_ko:"Í∏∞ÏÜåÏßÄ ÏßÄÏó≠"},{id:"alps",lat:36.5045,lon:137.8518,name_ja:"Â§ßÁî∫Â∏Ç",name_en:"Omachi",name_zh:"Â§ßÁî∫Â∏Ç",name_ko:"Ïò§ÎßàÏπòÏãú",region_ja:"Êó•Êú¨„Ç¢„É´„Éó„Çπ„Ç®„É™„Ç¢",region_en:"Japan Alps Area",region_zh:"Êó•Êú¨ÈòøÂ∞îÂçëÊñØÂå∫Âüü",region_ko:"ÏùºÎ≥∏ ÏïåÌîÑÏä§ ÏßÄÏó≠"}],warning_areas:[{code:"016000",label_ja:"Êú≠Âπå(ÂåóÊµ∑ÈÅì)",label_en:"Sapporo (Hokkaido)",label_zh:"Êú≠ÂπåÔºàÂåóÊµ∑ÈÅìÔºâ"},{code:"040000",label_ja:"‰ªôÂè∞(ÂÆÆÂüéÁúå)",label_en:"Sendai (Miyagi)",label_zh:"‰ªôÂè∞ÔºàÂÆ´ÂüéÂéøÔºâ"},{code:"130000",label_ja:"Êù±‰∫¨(Êù±‰∫¨ÈÉΩ)",label_en:"Tokyo (Tokyo)",label_zh:"‰∏ú‰∫¨Ôºà‰∏ú‰∫¨ÈÉΩÔºâ"},{code:"230000",label_ja:"ÂêçÂè§Â±ã(ÊÑõÁü•Áúå)",label_en:"Nagoya (Aichi)",label_zh:"ÂêçÂè§Â±ãÔºàÁà±Áü•ÂéøÔºâ"},{code:"270000",label_ja:"Â§ßÈò™(Â§ßÈò™Â∫ú)",label_en:"Osaka (Osaka)",label_zh:"Â§ßÈò™ÔºàÂ§ßÈò™Â∫úÔºâ"},{code:"400000",label_ja:"Á¶èÂ≤°(Á¶èÂ≤°Áúå)",label_en:"Fukuoka (Fukuoka)",label_zh:"Á¶èÂÜàÔºàÁ¶èÂÜàÂéøÔºâ"},{code:"200000",label_ja:"Èï∑ÈáéÁúå",label_en:"Nagano",label_zh:"ÈïøÈáéÂéø"}],wmo:[{code:0,icon:"‚òÄÔ∏è",ja:"Âø´Êô¥",en:"Clear",ko:"ÎßëÏùå"},{code:1,icon:"üå§Ô∏è",ja:"Êô¥„Çå",en:"Mostly clear",ko:"ÎåÄÏ≤¥Î°ú ÎßëÏùå"},{code:2,icon:"‚õÖ",ja:"Êô¥„Çå„ÅÆ„Å°Êõá„Çä",en:"Partly cloudy",ko:"Î∂ÄÎ∂ÑÏ†ÅÏúºÎ°ú ÌùêÎ¶º"},{code:3,icon:"‚òÅÔ∏è",ja:"Êõá„Çä",en:"Cloudy",ko:"ÌùêÎ¶º"},{code:45,icon:"üå´Ô∏è",ja:"Èúß",en:"Fog",ko:"ÏïàÍ∞ú"},{code:48,icon:"üå´Ô∏è",ja:"Èúß(ÁùÄÊ∞∑)",en:"Rime fog",ko:"Ï∞©Îπô ÏïàÍ∞ú"},{code:51,icon:"üå¶Ô∏è",ja:"ÈúßÈõ®(Âº±)",en:"Light drizzle",ko:"ÏïΩÌïú Ïù¥Ïä¨ÎπÑ"},{code:53,icon:"üå¶Ô∏è",ja:"ÈúßÈõ®",en:"Drizzle",ko:"Ïù¥Ïä¨ÎπÑ"},{code:55,icon:"üå¶Ô∏è",ja:"ÈúßÈõ®(Âº∑)",en:"Dense drizzle",ko:"Í∞ïÌïú Ïù¥Ïä¨ÎπÑ"},{code:61,icon:"üåßÔ∏è",ja:"Èõ®(Âº±)",en:"Light rain",ko:"ÏïΩÌïú ÎπÑ"},{code:63,icon:"üåßÔ∏è",ja:"Èõ®",en:"Rain",ko:"ÎπÑ"},{code:65,icon:"üåßÔ∏è",ja:"Èõ®(Âº∑)",en:"Heavy rain",ko:"Í∞ïÌïú ÎπÑ"},{code:71,icon:"üå®Ô∏è",ja:"Èõ™(Âº±)",en:"Light snow",ko:"ÏïΩÌïú Îàà"},{code:73,icon:"‚ùÑÔ∏è",ja:"Èõ™",en:"Snow",ko:"Îàà"},{code:75,icon:"‚ùÑÔ∏è",ja:"Èõ™(Âº∑)",en:"Heavy snow",ko:"Í∞ïÌïú Îàà"},{code:77,icon:"üå®Ô∏è",ja:"„ÅÇ„Çâ„Çå",en:"Snow grains",ko:"Ïã∏ÎùΩÎàà"},{code:80,icon:"üå¶Ô∏è",ja:"„Å´„Çè„ÅãÈõ®(Âº±)",en:"Light showers",ko:"ÏïΩÌïú ÏÜåÎÇòÍ∏∞"},{code:81,icon:"üå¶Ô∏è",ja:"„Å´„Çè„ÅãÈõ®",en:"Showers",ko:"ÏÜåÎÇòÍ∏∞"},{code:82,icon:"‚õàÔ∏è",ja:"„Å´„Çè„ÅãÈõ®(Âº∑)",en:"Heavy showers",ko:"Í∞ïÌïú ÏÜåÎÇòÍ∏∞"},{code:85,icon:"üå®Ô∏è",ja:"„Å´„Çè„ÅãÈõ™",en:"Snow showers",ko:"Îàà ÏÜåÎÇòÍ∏∞"},{code:86,icon:"üå®Ô∏è",ja:"„Å´„Çè„ÅãÈõ™(Âº∑)",en:"Heavy snow showers",ko:"Í∞ïÌïú Îàà ÏÜåÎÇòÍ∏∞"},{code:95,icon:"‚õàÔ∏è",ja:"Èõ∑Èõ®",en:"Thunderstorm",ko:"ÎáåÏö∞"},{code:96,icon:"‚õàÔ∏è",ja:"Èõ∑Èõ®+„Å≤„Çá„ÅÜ",en:"Storm + hail",ko:"ÎáåÏö∞+Ïö∞Î∞ï"},{code:99,icon:"‚õàÔ∏è",ja:"ÊøÄ„Åó„ÅÑÈõ∑Èõ®",en:"Severe storm",ko:"Í∞ïÌïú ÎáåÏö∞"}]};function F(n){if(n>=1.5)return{symbol:"‚Üë",cls:"up-fast"};if(n>=0.5)return{symbol:"‚Üó",cls:"up"};if(n<=-1.5)return{symbol:"‚Üì",cls:"down-fast"};if(n<=-0.5)return{symbol:"‚Üò",cls:"down"};return{symbol:"‚Üí",cls:"flat"}}function U(n){let e=Number(n?.current?.temperature_2m),i=n?.hourly?.time||[],a=n?.hourly?.temperature_2m||[];if(!Number.isFinite(e)||i.length===0)return 0;let o=Date.now()-1800000,_=-1,g=1/0;for(let r=0;r<i.length;r++){let m=Math.abs(new Date(i[r]).getTime()-o);if(m<g)g=m,_=r}if(_<0||!Number.isFinite(Number(a[_])))return 0;return e-Number(a[_])}function h(n,e,i){let a=document.getElementById(n);if(!a)return;let o=(e||"").trim()||i;a.textContent=`${o}„ÄÄ‚óÜ„ÄÄ${o}„ÄÄ‚óÜ„ÄÄ`,a.style.animationDuration=`${Math.max(24,Math.min(90,Math.round(o.length*0.45)))}s`}function s(n){return`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`}class k{static ORDER=["ja","en","zh","ko"];_lang="ja";_langIdx=0;ui;wmoMap;constructor(n){this.ui=n.ui,this.wmoMap=new Map(n.wmo.map((e)=>[e.code,e]))}get lang(){return this._lang}get t(){return this.ui[this._lang]}rotateLang(){this._langIdx=(this._langIdx+1)%k.ORDER.length,this._lang=k.ORDER[this._langIdx]}display(n){let e=this._lang,i=e==="en"?n.name_en||n.name_ja:e==="zh"?n.name_zh||n.name_en||n.name_ja:e==="ko"?n.name_ko||n.name_en||n.name_ja:n.name_ja,a=e==="en"?n.region_en||n.region_ja:e==="zh"?n.region_zh||n.region_en||n.region_ja:e==="ko"?n.region_ko||n.region_en||n.region_ja:n.region_ja;return{name:i,region:a}}decodeWMO(n){return this.wmoMap.get(n)??{code:n,icon:"‚ùì",ja:`(${n})`,en:`(${n})`,ko:`(${n})`}}wmoDesc(n){let e=this._lang;return e==="en"?n.en:e==="zh"?n.zh||n.en:e==="ko"?n.ko||n.en:n.ja}}class b{i18n;getNextRefreshAt;elClock=document.getElementById("clock");elClock12=document.getElementById("clock12-str");elWeekday=document.getElementById("weekday-str");elDate=document.getElementById("date-str");elNextUpd=document.getElementById("next-update");constructor(n,e){this.i18n=n;this.getNextRefreshAt=e}tick(){let n=new Date,e=n.getHours();this.elClock.textContent=`${String(e).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;let i=this.i18n.t,a=(e+11)%12+1,o=e<12?i.am:i.pm;if(this.elClock12)this.elClock12.textContent=this.i18n.lang==="en"?`${o} ${a}:00`:`${o}${a}${i.hourUnit}`;if(this.elWeekday)this.elWeekday.textContent=i.weekdays[n.getDay()];let _=this.calendarMode(n);if(this.elDate)this.elDate.textContent=this.formatDate(n,_),this.elDate.classList.toggle("is-chinese-cal",_==="chinese");this.updateNextUpdate(n)}updateNextUpdate(n=new Date){let e=Math.max(0,this.getNextRefreshAt()-n.getTime()),i=String(Math.floor(e/60000)).padStart(2,"0"),a=String(Math.floor(e%60000/1000)).padStart(2,"0");if(this.elNextUpd)this.elNextUpd.textContent=`${this.i18n.t.nextUpdate} ${i}:${a}`}formatDate(n,e){let i=n.getFullYear(),a=n.getMonth()+1,o=n.getDate(),_=`${i}/${String(a).padStart(2,"0")}/${String(o).padStart(2,"0")}`;try{if(e==="japanese")return new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{year:"numeric",month:"2-digit",day:"2-digit"}).format(n);if(e==="chinese")return new Intl.DateTimeFormat("zh-CN-u-ca-chinese",{year:"numeric",month:"long",day:"numeric"}).format(n)}catch{}return _}calendarMode(n){let e=Math.floor(n.getTime()/6000);if(this.i18n.lang==="zh")return["gregory","japanese","chinese"][e%3];return["gregory","japanese"][e%2]}}var p=1800000,j=4;class u{cities;nagano;i18n;_nextRefreshAt=Date.now()+p;cache={};naganoPage=0;get nextRefreshAt(){return this._nextRefreshAt}constructor(n,e,i){this.cities=n;this.nagano=e;this.i18n=i}init(){let n=document.getElementById("cities-grid");this.cities.forEach((e)=>n.appendChild(this.buildCard(e))),this.renderNaganoPage(0)}async refresh(){let n=document.getElementById("last-updated");if(n)n.textContent=this.i18n.t.updating;await Promise.allSettled([...this.cities,...this.nagano].map(async(i)=>{try{let a=await this.fetchWeather(i);this.cache[i.id]=a,this.updateCard(i,a)}catch{this.setCardError(i)}})),this.updateCityTicker();let e=new Date;if(this._nextRefreshAt=e.getTime()+p,n)n.textContent=`${this.i18n.t.updated}: ${s(e)}`}renderNaganoPage(n){let e=document.getElementById("nagano-grid");if(!e)return;let i=Math.ceil(this.nagano.length/j);this.naganoPage=(n%i+i)%i;let a=this.nagano.slice(this.naganoPage*j,(this.naganoPage+1)*j);e.innerHTML="",a.forEach((_)=>{if(e.appendChild(this.buildCard(_)),this.cache[_.id])this.updateCard(_,this.cache[_.id])});let o=document.getElementById("nagano-page-indicator");if(o)o.textContent=`(${this.naganoPage+1}/${i})`}nextNaganoPage(){this.renderNaganoPage(this.naganoPage+1)}redrawAll(){this.cities.forEach((n)=>{if(this.cache[n.id])this.updateCard(n,this.cache[n.id])}),this.renderNaganoPage(this.naganoPage)}async fetchWeather(n){let e=`https://api.open-meteo.com/v1/forecast?latitude=${n.lat}&longitude=${n.lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&hourly=temperature_2m&past_hours=2&forecast_hours=1&timezone=Asia%2FTokyo&forecast_days=1`,i=await fetch(e);if(!i.ok)throw Error(i.status.toString());return i.json()}buildCard(n){let e=document.createElement("div");e.className="weather-card",e.id=`card-${n.id}`;let{name:i,region:a}=this.i18n.display(n);return e.innerHTML=`
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div class="card-city">${i}</div>
          <div class="card-region">${a}</div>
        </div>
        <div class="loading">‚Ä¶</div>
      </div>
    `,e}updateCard(n,e){let i=document.getElementById(`card-${n.id}`);if(!i)return;let{current:a,daily:o}=e,_=this.i18n.decodeWMO(a.weather_code),{name:g,region:r}=this.i18n.display(n),m=this.i18n.t,z=F(U(e));i.innerHTML=`
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div class="card-city">${g}</div>
          <div class="card-region">${r}</div>
        </div>
        <div class="card-precip">${m.precip}:${o.precipitation_probability_max[0]??"--"}%</div>
      </div>
      <div class="card-weather-row">
        <span class="card-icon">${_.icon}</span>
        <div>
          <div>
            <span class="card-temp">${Math.round(a.temperature_2m)}</span>
            <span class="card-temp-unit">¬∞C</span>
            <span class="card-trend ${z.cls}">${z.symbol}</span>
          </div>
          <div class="card-desc">${this.i18n.wmoDesc(_)}</div>
        </div>
      </div>
      <div class="card-minmax">
        <span class="max">‚Üë${Math.round(o.temperature_2m_max[0])}¬∞</span>
        &nbsp;
        <span class="min">‚Üì${Math.round(o.temperature_2m_min[0])}¬∞</span>
      </div>
      <div class="card-details">
        <span class="card-detail">\uD83D\uDCA8 ${m.wind} ${Math.round(a.wind_speed_10m)}km/h</span>
        <span class="card-detail">\uD83D\uDCA7 ${m.humidity} ${a.relative_humidity_2m}%</span>
      </div>
    `,i.classList.add("loaded")}setCardError(n){let e=document.getElementById(`card-${n.id}`);if(!e)return;let{name:i,region:a}=this.i18n.display(n);e.innerHTML=`
      <div class="card-city">${i}</div>
      <div class="card-region">${a}</div>
      <div class="error">${this.i18n.t.failed}</div>
    `}updateCityTicker(){let n=this.cities.map((e)=>{let i=this.cache[e.id];if(!i?.current||!i?.daily)return`${e.name_ja}: --`;let a=this.i18n.decodeWMO(i.current.weather_code),o=i.daily.precipitation_probability_max?.[0]??"--";return`${this.i18n.display(e).name} ${Math.round(i.current.temperature_2m)}¬∞C ${this.i18n.wmoDesc(a)} ${this.i18n.t.precip}${o}%`});h("city-track",n.join(" ÔΩú "),this.i18n.t.noInfo)}}class w{areas;i18n;constructor(n,e){this.areas=n;this.i18n=e}async fetch(){try{let e=(await Promise.allSettled(this.areas.map(async(i)=>{let a=await fetch(`https://www.jma.go.jp/bosai/warning/data/warning/${i.code}.json`);if(!a.ok)throw Error(String(a.status));let o=await a.json(),_=(o.headlineText||"").trim(),g=(o.reportDatetime||"").replace("T"," ").replace("+09:00","");if(!_)return`${i.label_ja}: ${this.i18n.ui.ja.warningNoHeadline}`;return`${i.label_ja} [${g}] ${_}`}))).map((i,a)=>i.status==="fulfilled"?i.value:`${this.areas[a].label_ja}: ${this.i18n.ui.ja.warningFetchFailed}`);h("alert-track",e.join(" ÔΩú "),this.i18n.t.noInfo)}catch{h("alert-track",this.i18n.ui.ja.warningAllFailed,this.i18n.t.noInfo)}}}class y{i18n;el=document.getElementById("pi-status");constructor(n){this.i18n=n}async fetch(){try{let n=await fetch("/api/pi-status");if(!n.ok)throw Error("status");let e=await n.json(),i=this.i18n.t,a=e.mem?`${e.mem.used_gb}/${e.mem.total_gb}GB (${e.mem.used_pct}%)`:"--",o=e.disk?`${e.disk.used_gb}/${e.disk.total_gb}GB (${e.disk.used_pct}%)`:"--";this.el.innerHTML=`
        <span>${i.piTemp}: <b>${e.cpu_temp_c??"--"}¬∞C</b></span>
        <span>${i.piLoad}: <b>${e.load1??"--"}</b></span>
        <span>${i.piMem}: <b>${a}</b></span>
        <span>${i.piDisk}: <b>${o}</b></span>
        <span>${i.piUptime}: <b>${e.uptime||"--"}</b></span>
        <span>${i.piIp}: <b>${e.ip||"--"}</b></span>
      `}catch{this.el.innerHTML=`<span>${this.i18n.t.failed}</span>`}}}class l{i18n;grid;clock;warning;pi;pageSwitchCount=0;constructor(){let n=d;this.i18n=new k(n),this.grid=new u(n.cities,n.nagano,this.i18n),this.clock=new b(this.i18n,()=>this.grid.nextRefreshAt),this.warning=new w(n.warning_areas,this.i18n),this.pi=new y(this.i18n)}start(){this.applyLang(),this.grid.init(),this.clock.tick(),setInterval(()=>this.clock.tick(),1000),this.grid.refresh(),this.warning.fetch(),this.pi.fetch(),document.body.classList.add("cursor-hidden"),this.initCursorHide(),setInterval(()=>void this.grid.refresh(),p),setInterval(()=>void this.warning.fetch(),600000),setInterval(()=>void this.pi.fetch(),60000),setInterval(()=>this.onPageSwitch(),12000)}applyLang(){let n=this.i18n.t;[["board-title",n.boardTitle],["warning-title",n.warningTitle],["pi-title",n.piTitle],["major-label",n.majorLabel],["nagano-label",n.naganoLabel]].forEach(([e,i])=>{let a=document.getElementById(e);if(a)a.textContent=i}),this.clock.updateNextUpdate()}rotateLang(){this.i18n.rotateLang(),this.applyLang(),this.grid.redrawAll(),this.warning.fetch(),this.pi.fetch(),this.updateLastUpdated()}onPageSwitch(){if(this.grid.nextNaganoPage(),this.pageSwitchCount++,this.pageSwitchCount%2===0)this.rotateLang()}initCursorHide(){let n,e=()=>{document.body.classList.remove("cursor-hidden"),clearTimeout(n),n=setTimeout(()=>document.body.classList.add("cursor-hidden"),3000)};["mousemove","mousedown","wheel","touchstart","keydown"].forEach((i)=>window.addEventListener(i,e,{passive:!0}))}updateLastUpdated(){let n=new Date,e=document.getElementById("last-updated");if(e)e.textContent=`${this.i18n.t.updated}: ${s(n)}`}}new l().start();
