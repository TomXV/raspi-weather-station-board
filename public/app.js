var R=[{id:"sapporo",name:"札幌",enName:"Sapporo",zhName:"札幌",koName:"삿포로",region:"北海道",enRegion:"Hokkaido",zhRegion:"北海道",koRegion:"홋카이도",lat:43.0618,lon:141.3545},{id:"sendai",name:"仙台",enName:"Sendai",zhName:"仙台",koName:"센다이",region:"宮城県",enRegion:"Miyagi",zhRegion:"宫城县",koRegion:"미야기현",lat:38.2688,lon:140.8721},{id:"tokyo",name:"東京",enName:"Tokyo",zhName:"东京",koName:"도쿄",region:"東京都",enRegion:"Tokyo",zhRegion:"东京都",koRegion:"도쿄도",lat:35.6762,lon:139.6503},{id:"nagoya",name:"名古屋",enName:"Nagoya",zhName:"名古屋",koName:"나고야",region:"愛知県",enRegion:"Aichi",zhRegion:"爱知县",koRegion:"아이치현",lat:35.1815,lon:136.9066},{id:"osaka",name:"大阪",enName:"Osaka",zhName:"大阪",koName:"오사카",region:"大阪府",enRegion:"Osaka",zhRegion:"大阪府",koRegion:"오사카부",lat:34.6937,lon:135.5023},{id:"fukuoka",name:"福岡",enName:"Fukuoka",zhName:"福冈",koName:"후쿠오카",region:"福岡県",enRegion:"Fukuoka",zhRegion:"福冈县",koRegion:"후쿠오카현",lat:33.5904,lon:130.4017}],W=[{id:"hokushin",name:"長野市",enName:"Nagano",zhName:"长野市",koName:"나가노시",region:"北信",enRegion:"North Shin",zhRegion:"北信",koRegion:"북신",lat:36.6485,lon:138.1948},{id:"toushin",name:"上田市",enName:"Ueda",zhName:"上田市",koName:"우에다시",region:"東信",enRegion:"East Shin",zhRegion:"东信",koRegion:"동신",lat:36.402,lon:138.249},{id:"chushin",name:"松本市",enName:"Matsumoto",zhName:"松本市",koName:"마쓰모토시",region:"中信",enRegion:"Central Shin",zhRegion:"中信",koRegion:"중신",lat:36.238,lon:137.9724},{id:"nanshin",name:"飯田市",enName:"Iida",zhName:"饭田市",koName:"이다시",region:"南信",enRegion:"South Shin",zhRegion:"南信",koRegion:"남신",lat:35.5151,lon:137.8217},{id:"suwa",name:"諏訪市",enName:"Suwa",zhName:"诹访市",koName:"스와시",region:"諏訪エリア",enRegion:"Suwa Area",zhRegion:"诹访区域",koRegion:"스와 지역",lat:36.0392,lon:138.1131},{id:"inaji",name:"伊那市",enName:"Ina",zhName:"伊那市",koName:"이나시",region:"伊那路エリア",enRegion:"Inaji Area",zhRegion:"伊那路区域",koRegion:"이나지 지역",lat:35.8274,lon:137.9537},{id:"kisoj",name:"木曽町",enName:"Kiso",zhName:"木曾町",koName:"기소마치",region:"木曽路エリア",enRegion:"Kisoji Area",zhRegion:"木曾路区域",koRegion:"기소지 지역",lat:35.8423,lon:137.6937},{id:"alps",name:"大町市",enName:"Omachi",zhName:"大町市",koName:"오마치시",region:"日本アルプスエリア",enRegion:"Japan Alps Area",zhRegion:"日本阿尔卑斯区域",koRegion:"일본 알프스 지역",lat:36.5045,lon:137.8518}],P=[{code:"016000",labelJa:"札幌(北海道)",labelEn:"Sapporo (Hokkaido)",labelZh:"札幌（北海道）"},{code:"040000",labelJa:"仙台(宮城県)",labelEn:"Sendai (Miyagi)",labelZh:"仙台（宫城县）"},{code:"130000",labelJa:"東京(東京都)",labelEn:"Tokyo (Tokyo)",labelZh:"东京（东京都）"},{code:"230000",labelJa:"名古屋(愛知県)",labelEn:"Nagoya (Aichi)",labelZh:"名古屋（爱知县）"},{code:"270000",labelJa:"大阪(大阪府)",labelEn:"Osaka (Osaka)",labelZh:"大阪（大阪府）"},{code:"400000",labelJa:"福岡(福岡県)",labelEn:"Fukuoka (Fukuoka)",labelZh:"福冈（福冈县）"},{code:"200000",labelJa:"長野県",labelEn:"Nagano",labelZh:"长野县"}],J="ja",$={ja:{boardTitle:"⛅ 気象情報ボード",warningTitle:"⚠ 警報・注意報（主要都市 + 長野県 / 生文）",piTitle:"\uD83D\uDDA5 Raspberry Pi ステータス",majorLabel:"▶ 主要都市",naganoLabel:"▶ 長野県",updated:"最終更新",updating:"更新中...",precip:"降水量",wind:"風速",humidity:"湿度",failed:"取得失敗",page:"ページ",calGregorian:"西暦",calJapanese:"和暦",calChinese:"中国暦"},en:{boardTitle:"⛅ Weather Board",warningTitle:"⚠ Warning / Advisory (Major Cities + Nagano / Raw Text)",piTitle:"\uD83D\uDDA5 Raspberry Pi Status",majorLabel:"▶ Major Cities",naganoLabel:"▶ Nagano",updated:"Updated",updating:"Updating...",precip:"Rain",wind:"Wind",humidity:"Humidity",failed:"Fetch Failed",page:"Page",calGregorian:"Gregorian",calJapanese:"Japanese Era",calChinese:"Chinese Calendar"},zh:{boardTitle:"⛅ 气象信息看板",warningTitle:"⚠ 警报/注意报（主要城市 + 长野 / 原文）",piTitle:"\uD83D\uDDA5 Raspberry Pi 状态",majorLabel:"▶ 主要城市",naganoLabel:"▶ 长野",updated:"更新",updating:"更新中...",precip:"降水",wind:"风速",humidity:"湿度",failed:"获取失败",page:"页",calGregorian:"公历",calJapanese:"和历",calChinese:"农历"},ko:{boardTitle:"⛅ 기상 정보 보드",warningTitle:"⚠ 경보/주의보 (주요 도시 + 나가노 / 원문)",piTitle:"\uD83D\uDDA5 Raspberry Pi 상태",majorLabel:"▶ 주요 도시",naganoLabel:"▶ 나가노",updated:"갱신",updating:"갱신 중...",precip:"강수",wind:"풍속",humidity:"습도",failed:"가져오기 실패",page:"페이지",calGregorian:"서기",calJapanese:"화력",calChinese:"중국력"}};function N(q){return{0:{icon:"☀️",ja:"快晴",en:"Clear",ko:"맑음"},1:{icon:"\uD83C\uDF24️",ja:"ほぼ晴れ",en:"Mostly clear",ko:"대체로 맑음"},2:{icon:"⛅",ja:"一部曇り",en:"Partly cloudy",ko:"부분적으로 흐림"},3:{icon:"☁️",ja:"曇り",en:"Cloudy",ko:"흐림"},45:{icon:"\uD83C\uDF2B️",ja:"霧",en:"Fog",ko:"안개"},48:{icon:"\uD83C\uDF2B️",ja:"霧(着氷)",en:"Rime fog",ko:"착빙 안개"},51:{icon:"\uD83C\uDF26️",ja:"霧雨(弱)",en:"Light drizzle",ko:"약한 이슬비"},53:{icon:"\uD83C\uDF26️",ja:"霧雨",en:"Drizzle",ko:"이슬비"},55:{icon:"\uD83C\uDF26️",ja:"霧雨(強)",en:"Dense drizzle",ko:"강한 이슬비"},61:{icon:"\uD83C\uDF27️",ja:"雨(弱)",en:"Light rain",ko:"약한 비"},63:{icon:"\uD83C\uDF27️",ja:"雨",en:"Rain",ko:"비"},65:{icon:"\uD83C\uDF27️",ja:"雨(強)",en:"Heavy rain",ko:"강한 비"},71:{icon:"\uD83C\uDF28️",ja:"雪(弱)",en:"Light snow",ko:"약한 눈"},73:{icon:"❄️",ja:"雪",en:"Snow",ko:"눈"},75:{icon:"❄️",ja:"雪(強)",en:"Heavy snow",ko:"강한 눈"},77:{icon:"\uD83C\uDF28️",ja:"あられ",en:"Snow grains",ko:"싸락눈"},80:{icon:"\uD83C\uDF26️",ja:"にわか雨(弱)",en:"Light showers",ko:"약한 소나기"},81:{icon:"\uD83C\uDF26️",ja:"にわか雨",en:"Showers",ko:"소나기"},82:{icon:"⛈️",ja:"にわか雨(強)",en:"Heavy showers",ko:"강한 소나기"},85:{icon:"\uD83C\uDF28️",ja:"にわか雪",en:"Snow showers",ko:"눈 소나기"},86:{icon:"\uD83C\uDF28️",ja:"にわか雪(強)",en:"Heavy snow showers",ko:"강한 눈 소나기"},95:{icon:"⛈️",ja:"雷雨",en:"Thunderstorm",ko:"뇌우"},96:{icon:"⛈️",ja:"雷雨+ひょう",en:"Storm + hail",ko:"뇌우+우박"},99:{icon:"⛈️",ja:"激しい雷雨",en:"Severe storm",ko:"강한 뇌우"}}[q]||{icon:"❓",ja:`(${q})`,en:`(${q})`,ko:`(${q})`}}function f(q){let B=J==="en"?q.enName||q.name:J==="zh"?q.zhName||q.enName||q.name:J==="ko"?q.koName||q.enName||q.name:q.name,z=J==="en"?q.enRegion||q.region:J==="zh"?q.zhRegion||q.enRegion||q.region:J==="ko"?q.koRegion||q.enRegion||q.region:q.region;return{name:B,region:z}}function A(){let q=$[J],B=document.getElementById("board-title");if(B)B.textContent=q.boardTitle;let z=document.getElementById("warning-title");if(z)z.textContent=q.warningTitle;let F=document.getElementById("pi-title");if(F)F.textContent=q.piTitle;let K=document.getElementById("major-label");if(K)K.textContent=q.majorLabel;let Q=document.getElementById("nagano-label");if(Q)Q.textContent=q.naganoLabel}function x(q){return q.labelJa}function C(q,B){let z=document.createElement("div");z.className="weather-card",z.id=`card-${q.id}`;let F=f(q);return z.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div class="card-city">${F.name}</div>
        <div class="card-region">${F.region}</div>
      </div>
      <div class="loading">…</div>
    </div>
  `,z}var U=4,M=0,H={};function b(q){let B=document.getElementById("nagano-grid");if(!B)return;let z=Math.ceil(W.length/U);M=(q%z+z)%z;let F=M*U,K=W.slice(F,F+U);B.innerHTML="",K.forEach((V)=>{if(B.appendChild(C(V,!0)),H[V.id])G(V,H[V.id])});let Q=document.getElementById("nagano-page-indicator");if(Q)Q.textContent=`(${M+1}/${z})`}function h(){let q=document.getElementById("cities-grid");R.forEach((B)=>q.appendChild(C(B,!1))),b(0)}async function p(q){let B=`https://api.open-meteo.com/v1/forecast?latitude=${q.lat}&longitude=${q.lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo&forecast_days=1`,z=await fetch(B);if(!z.ok)throw Error(z.status);return z.json()}function O(q,B){let z=document.getElementById(q);if(!z)return;let F=(B||"").trim()||"情報なし";z.textContent=`${F}　◆　${F}　◆　`;let K=Math.max(24,Math.min(90,Math.round(F.length*0.45)));z.style.animationDuration=`${K}s`}function L(){let q=R.map((B)=>{let z=H[B.id];if(!z||!z.current||!z.daily)return`${B.name}: --`;let{desc:F}=N(z.current.weather_code),K=Math.round(z.current.temperature_2m),Q=z.daily.precipitation_probability_max?.[0]??"--";return`${B.name} ${K}°C ${F} 降水${Q}%`});O("city-track",q.join(" ｜ "))}async function k(){try{let B=(await Promise.allSettled(P.map(async(z)=>{let F=await fetch(`https://www.jma.go.jp/bosai/warning/data/warning/${z.code}.json`);if(!F.ok)throw Error(String(F.status));let K=await F.json(),Q=(K.headlineText||"").trim(),V=(K.reportDatetime||"").replace("T"," ").replace("+09:00",""),j=x(z);if(!Q)return`${j}: 現在、目立つ警報見出しなし`;return`${j} [${V}] ${Q}`}))).map((z,F)=>{if(z.status==="fulfilled")return z.value;return`${x(P[F])}: 取得失敗`});O("alert-track",B.join(" ｜ "))}catch(q){O("alert-track","警報・注意報情報の取得に失敗")}}async function y(){try{let q=await fetch("/api/pi-status");if(!q.ok)throw Error("status");let B=await q.json(),z=B.mem?`${B.mem.used_gb}/${B.mem.total_gb}GB (${B.mem.used_pct}%)`:"--",F=B.disk?`${B.disk.used_gb}/${B.disk.total_gb}GB (${B.disk.used_pct}%)`:"--",K=B.cpu_temp_c??"--",Q=B.load1??"--",V=B.uptime||"--",j=B.ip||"--",Y=J==="en"?{temp:"Temp",load:"Load",mem:"Memory",disk:"Disk",up:"Uptime",ip:"IP"}:J==="zh"?{temp:"温度",load:"负载",mem:"内存",disk:"磁盘",up:"运行时长",ip:"IP"}:J==="ko"?{temp:"온도",load:"부하",mem:"메모리",disk:"디스크",up:"가동시간",ip:"IP"}:{temp:"温度",load:"負荷",mem:"メモリ",disk:"ディスク",up:"稼働",ip:"IP"};document.getElementById("pi-status").innerHTML=`
      <span>${Y.temp}: <b>${K}°C</b></span>
      <span>${Y.load}: <b>${Q}</b></span>
      <span>${Y.mem}: <b>${z}</b></span>
      <span>${Y.disk}: <b>${F}</b></span>
      <span>${Y.up}: <b>${V}</b></span>
      <span>${Y.ip}: <b>${j}</b></span>
    `}catch(q){document.getElementById("pi-status").innerHTML=`<span>${$[J].failed}</span>`}}function G(q,B){let z=document.getElementById(`card-${q.id}`);if(!z)return;let{current:F,daily:K}=B,Q=N(F.weather_code),V=J==="en"?Q.en:J==="zh"?Q.zh||Q.en:J==="ko"?Q.ko||Q.en:Q.ja,j=Math.round(K.temperature_2m_max[0]),Y=Math.round(K.temperature_2m_min[0]),D=K.precipitation_probability_max[0]??"--",Z=f(q),v=$[J];z.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div class="card-city">${Z.name}</div>
        <div class="card-region">${Z.region}</div>
      </div>
      <div class="card-precip">${v.precip}:${D}%</div>
    </div>
    <div class="card-weather-row">
      <span class="card-icon">${Q.icon}</span>
      <div>
        <div>
          <span class="card-temp">${Math.round(F.temperature_2m)}</span>
          <span class="card-temp-unit">°C</span>
        </div>
        <div class="card-desc">${V}</div>
      </div>
    </div>
    <div class="card-minmax">
      <span class="max">↑${j}°</span>
      &nbsp;
      <span class="min">↓${Y}°</span>
    </div>
    <div class="card-details">
      <span class="card-detail">\uD83D\uDCA8 ${v.wind} ${Math.round(F.wind_speed_10m)}km/h</span>
      <span class="card-detail">\uD83D\uDCA7 ${v.humidity} ${F.relative_humidity_2m}%</span>
    </div>
  `,z.classList.add("loaded")}function i(q,B){let z=document.getElementById(`card-${q.id}`);if(!z)return;let F=f(q);z.innerHTML=`
    <div class="card-city">${F.name}</div>
    <div class="card-region">${F.region}</div>
    <div class="error">${$[J].failed}</div>
  `}async function E(){document.getElementById("last-updated").textContent=`${$[J].updating}`;let q=[...R,...W];await Promise.allSettled(q.map(async(z)=>{try{let F=await p(z);H[z.id]=F,G(z,F)}catch(F){i(z,F.message)}})),L();let B=new Date;document.getElementById("last-updated").textContent=`${$[J].updated}: ${B.getHours().toString().padStart(2,"0")}:${B.getMinutes().toString().padStart(2,"0")}`}function u(q,B){let z=$[J];try{if(B==="gregory")return`${q.getFullYear()}/${String(q.getMonth()+1).padStart(2,"0")}/${String(q.getDate()).padStart(2,"0")}`;if(B==="japanese")return new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{year:"numeric",month:"2-digit",day:"2-digit"}).format(q);return new Intl.DateTimeFormat("zh-CN-u-ca-chinese",{year:"numeric",month:"long",day:"numeric"}).format(q)}catch{let F=`${q.getFullYear()}/${String(q.getMonth()+1).padStart(2,"0")}/${String(q.getDate()).padStart(2,"0")}`;return`${z.calGregorian}: ${F}`}}function s(q){let B=Math.floor(q.getTime()/6000);if(J==="zh")return["gregory","japanese","chinese"][B%3];return["gregory","japanese"][B%2]}function I(){let q=new Date,B=q.getHours().toString().padStart(2,"0"),z=q.getMinutes().toString().padStart(2,"0"),F=q.getSeconds().toString().padStart(2,"0");document.getElementById("clock").textContent=`${B}:${z}:${F}`;let K=["日","月","火","水","木","金","土"],Q=q.getFullYear(),V=(q.getMonth()+1).toString().padStart(2,"0"),j=q.getDate().toString().padStart(2,"0"),Y=K[q.getDay()],D=document.getElementById("weekday-str");if(D){let T=J==="en"?["SUN","MON","TUE","WED","THU","FRI","SAT"][q.getDay()]:J==="zh"?["周日","周一","周二","周三","周四","周五","周六"][q.getDay()]:J==="ko"?["일","월","화","수","목","금","토"][q.getDay()]:`${Y}曜`;D.textContent=T}let Z=s(q),v=document.getElementById("date-str");if(v)v.textContent=u(q,Z),v.classList.toggle("is-chinese-cal",Z==="chinese")}var S;function w(){document.body.classList.remove("cursor-hidden"),clearTimeout(S),S=setTimeout(()=>{document.body.classList.add("cursor-hidden")},3000)}["mousemove","mousedown","wheel","touchstart","keydown"].forEach((q)=>{window.addEventListener(q,w,{passive:!0})});var m=["ja","en","zh","ko"],X=0;function g(q){if(q===J)return;J=q,A(),R.forEach((z)=>{if(H[z.id])G(z,H[z.id])}),b(M),k(),y();let B=new Date;document.getElementById("last-updated").textContent=`${$[J].updated}: ${B.getHours().toString().padStart(2,"0")}:${B.getMinutes().toString().padStart(2,"0")}`}function d(){X=(X+1)%m.length,g(m[X])}A();h();I();setInterval(I,1000);E();k();y();document.body.classList.add("cursor-hidden");setInterval(E,1800000);setInterval(k,600000);setInterval(y,60000);var _=0;setInterval(()=>{if(b(M+1),_++,_%2===0)d()},12000);
