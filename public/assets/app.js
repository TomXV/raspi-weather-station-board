(()=>{"use strict";const n=[{id:"sapporo",name:"æœ­å¹Œ",region:"åŒ—æµ·é“",lat:43.0618,lon:141.3545},{id:"sendai",name:"ä»™å°",region:"å®®åŸçœŒ",lat:38.2688,lon:140.8721},{id:"tokyo",name:"æ±äº¬",region:"æ±äº¬éƒ½",lat:35.6762,lon:139.6503},{id:"nagoya",name:"åå¤å±‹",region:"æ„›çŸ¥çœŒ",lat:35.1815,lon:136.9066},{id:"osaka",name:"å¤§é˜ª",region:"å¤§é˜ªåºœ",lat:34.6937,lon:135.5023},{id:"fukuoka",name:"ç¦å²¡",region:"ç¦å²¡çœŒ",lat:33.5904,lon:130.4017}],e=[{id:"hokushin",name:"é•·é‡å¸‚",region:"åŒ—ä¿¡",lat:36.6485,lon:138.1948},{id:"toushin",name:"ä¸Šç”°å¸‚",region:"æ±ä¿¡",lat:36.402,lon:138.249},{id:"chushin",name:"æ¾æœ¬å¸‚",region:"ä¸­ä¿¡",lat:36.238,lon:137.9724},{id:"nanshin",name:"é£¯ç”°å¸‚",region:"å—ä¿¡",lat:35.5151,lon:137.8217},{id:"suwa",name:"è«è¨ªå¸‚",region:"è«è¨ªã‚¨ãƒªã‚¢",lat:36.0392,lon:138.1131},{id:"inaji",name:"ä¼Šé‚£å¸‚",region:"ä¼Šé‚£è·¯ã‚¨ãƒªã‚¢",lat:35.8274,lon:137.9537},{id:"kisoj",name:"æœ¨æ›½ç”º",region:"æœ¨æ›½è·¯ã‚¨ãƒªã‚¢",lat:35.8423,lon:137.6937},{id:"alps",name:"å¤§ç”ºå¸‚",region:"æ—¥æœ¬ã‚¢ãƒ«ãƒ—ã‚¹ã‚¨ãƒªã‚¢",lat:36.5045,lon:137.8518}],t=[{label:"æœ­å¹Œ(åŒ—æµ·é“)",code:"016000"},{label:"ä»™å°(å®®åŸçœŒ)",code:"040000"},{label:"æ±äº¬(æ±äº¬éƒ½)",code:"130000"},{label:"åå¤å±‹(æ„›çŸ¥çœŒ)",code:"230000"},{label:"å¤§é˜ª(å¤§é˜ªåºœ)",code:"270000"},{label:"ç¦å²¡(ç¦å²¡çœŒ)",code:"400000"},{label:"é•·é‡çœŒ",code:"200000"}];function a(n){return{0:{icon:"â˜€ï¸",desc:"å¿«æ™´"},1:{icon:"ğŸŒ¤ï¸",desc:"ã»ã¼æ™´ã‚Œ"},2:{icon:"â›…",desc:"ä¸€éƒ¨æ›‡ã‚Š"},3:{icon:"â˜ï¸",desc:"æ›‡ã‚Š"},45:{icon:"ğŸŒ«ï¸",desc:"éœ§"},48:{icon:"ğŸŒ«ï¸",desc:"éœ§(ç€æ°·)"},51:{icon:"ğŸŒ¦ï¸",desc:"éœ§é›¨(å¼±)"},53:{icon:"ğŸŒ¦ï¸",desc:"éœ§é›¨"},55:{icon:"ğŸŒ¦ï¸",desc:"éœ§é›¨(å¼·)"},61:{icon:"ğŸŒ§ï¸",desc:"é›¨(å¼±)"},63:{icon:"ğŸŒ§ï¸",desc:"é›¨"},65:{icon:"ğŸŒ§ï¸",desc:"é›¨(å¼·)"},71:{icon:"ğŸŒ¨ï¸",desc:"é›ª(å¼±)"},73:{icon:"â„ï¸",desc:"é›ª"},75:{icon:"â„ï¸",desc:"é›ª(å¼·)"},77:{icon:"ğŸŒ¨ï¸",desc:"ã‚ã‚‰ã‚Œ"},80:{icon:"ğŸŒ¦ï¸",desc:"ã«ã‚ã‹é›¨(å¼±)"},81:{icon:"ğŸŒ¦ï¸",desc:"ã«ã‚ã‹é›¨"},82:{icon:"â›ˆï¸",desc:"ã«ã‚ã‹é›¨(å¼·)"},85:{icon:"ğŸŒ¨ï¸",desc:"ã«ã‚ã‹é›ª"},86:{icon:"ğŸŒ¨ï¸",desc:"ã«ã‚ã‹é›ª(å¼·)"},95:{icon:"â›ˆï¸",desc:"é›·é›¨"},96:{icon:"â›ˆï¸",desc:"é›·é›¨+ã²ã‚‡ã†"},99:{icon:"â›ˆï¸",desc:"æ¿€ã—ã„é›·é›¨"}}[n]||{icon:"â“",desc:`(${n})`}}function i(n,e){const t=document.createElement("div");return t.className="weather-card",t.id=`card-${n.id}`,t.innerHTML=`\n    <div style="display:flex;justify-content:space-between;align-items:flex-start">\n      <div>\n        <div class="card-city">${n.name}</div>\n        <div class="card-region">${n.region}</div>\n      </div>\n      <div class="loading">â€¦</div>\n    </div>\n  `,t}let s=0;const d={};function o(n){const t=document.getElementById("nagano-grid");if(!t)return;const a=Math.ceil(e.length/4);s=(n%a+a)%a;const o=4*s,c=e.slice(o,o+4);t.innerHTML="",c.forEach(n=>{t.appendChild(i(n)),d[n.id]&&m(n,d[n.id])});const r=document.getElementById("nagano-page-indicator");r&&(r.textContent=`(${s+1}/${a})`)}function c(n,e){const t=document.getElementById(n);if(!t)return;const a=(e||"").trim()||"æƒ…å ±ãªã—";t.textContent=`${a}ã€€â—†ã€€${a}ã€€â—†ã€€`;const i=Math.max(24,Math.min(90,Math.round(.45*a.length)));t.style.animationDuration=`${i}s`}async function r(){try{c("alert-track",(await Promise.allSettled(t.map(async n=>{const e=await fetch(`https://www.jma.go.jp/bosai/warning/data/warning/${n.code}.json`);if(!e.ok)throw new Error(String(e.status));const t=await e.json(),a=(t.headlineText||"").trim(),i=(t.reportDatetime||"").replace("T"," ").replace("+09:00","");return a?`${n.label} [${i}] ${a}`:`${n.label}: ç¾åœ¨ã€ç›®ç«‹ã¤è­¦å ±è¦‹å‡ºã—ãªã—`}))).map((n,e)=>"fulfilled"===n.status?n.value:`${t[e].label}: å–å¾—å¤±æ•—`).join(" ï½œ "))}catch(n){c("alert-track","è­¦å ±ãƒ»æ³¨æ„å ±æƒ…å ±ã®å–å¾—ã«å¤±æ•—")}}async function l(){try{const n=await fetch("/api/pi-status");if(!n.ok)throw new Error("status");const e=await n.json(),t=e.mem?`${e.mem.used_gb}/${e.mem.total_gb}GB (${e.mem.used_pct}%)`:"--",a=e.disk?`${e.disk.used_gb}/${e.disk.total_gb}GB (${e.disk.used_pct}%)`:"--",i=e.cpu_temp_c??"--",s=e.load1??"--",d=e.uptime||"--",o=e.ip||"--";document.getElementById("pi-status").innerHTML=`\n      <span>æ¸©åº¦: <b>${i}Â°C</b></span>\n      <span>è² è·: <b>${s}</b></span>\n      <span>ãƒ¡ãƒ¢ãƒª: <b>${t}</b></span>\n      <span>ãƒ‡ã‚£ã‚¹ã‚¯: <b>${a}</b></span>\n      <span>ç¨¼åƒ: <b>${d}</b></span>\n      <span>IP: <b>${o}</b></span>\n    `}catch(n){document.getElementById("pi-status").innerHTML="<span>å–å¾—å¤±æ•—</span>"}}function m(n,e){const t=document.getElementById(`card-${n.id}`);if(!t)return;const i=e.current,s=e.daily,{icon:d,desc:o}=a(i.weather_code),c=Math.round(s.temperature_2m_max[0]),r=Math.round(s.temperature_2m_min[0]),l=s.precipitation_probability_max[0]??"--";t.innerHTML=`\n    <div style="display:flex;justify-content:space-between;align-items:flex-start">\n      <div>\n        <div class="card-city">${n.name}</div>\n        <div class="card-region">${n.region}</div>\n      </div>\n      <div class="card-precip">ğŸ’§${l}%</div>\n    </div>\n    <div class="card-weather-row">\n      <span class="card-icon">${d}</span>\n      <div>\n        <div>\n          <span class="card-temp">${Math.round(i.temperature_2m)}</span>\n          <span class="card-temp-unit">Â°C</span>\n        </div>\n        <div class="card-desc">${o}</div>\n      </div>\n    </div>\n    <div class="card-minmax">\n      <span class="max">â†‘${c}Â°</span>\n      &nbsp;\n      <span class="min">â†“${r}Â°</span>\n    </div>\n    <div class="card-details">\n      <span class="card-detail">ğŸ’¨ ${Math.round(i.wind_speed_10m)}km/h</span>\n      <span class="card-detail">ğŸ’§ ${i.relative_humidity_2m}%</span>\n    </div>\n  `,t.classList.add("loaded")}async function u(){document.getElementById("last-updated").textContent="æ›´æ–°ä¸­...";const t=[...n,...e];await Promise.allSettled(t.map(async n=>{try{const e=await async function(n){const e=`https://api.open-meteo.com/v1/forecast?latitude=${n.lat}&longitude=${n.lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo&forecast_days=1`,t=await fetch(e);if(!t.ok)throw new Error(t.status);return t.json()}(n);d[n.id]=e,m(n,e)}catch(e){!function(n){const e=document.getElementById(`card-${n.id}`);e&&(e.innerHTML=`\n    <div class="card-city">${n.name}</div>\n    <div class="card-region">${n.region}</div>\n    <div class="error">å–å¾—å¤±æ•—</div>\n  `)}(n,e.message)}})),c("city-track",n.map(n=>{const e=d[n.id];if(!e||!e.current||!e.daily)return`${n.name}: --`;const{desc:t}=a(e.current.weather_code),i=Math.round(e.current.temperature_2m),s=e.daily.precipitation_probability_max?.[0]??"--";return`${n.name} ${i}Â°C ${t} é™æ°´${s}%`}).join(" ï½œ "));const i=new Date;document.getElementById("last-updated").textContent=`æœ€çµ‚æ›´æ–°: ${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`}function p(){const n=new Date,e=n.getHours().toString().padStart(2,"0"),t=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0");document.getElementById("clock").textContent=`${e}:${t}:${a}`;const i=n.getFullYear(),s=(n.getMonth()+1).toString().padStart(2,"0"),d=n.getDate().toString().padStart(2,"0"),o=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][n.getDay()];document.getElementById("date-str").textContent=`${i}/${s}/${d} (${o})`}let g;function $(){document.body.classList.remove("cursor-hidden"),clearTimeout(g),g=setTimeout(()=>{document.body.classList.add("cursor-hidden")},3e3)}["mousemove","mousedown","wheel","touchstart","keydown"].forEach(n=>{window.addEventListener(n,$,{passive:!0})}),function(){const e=document.getElementById("cities-grid");n.forEach(n=>e.appendChild(i(n))),o(0)}(),p(),setInterval(p,1e3),u(),r(),l(),document.body.classList.add("cursor-hidden"),setInterval(u,18e5),setInterval(r,6e5),setInterval(l,6e4),setInterval(()=>o(s+1),12e3)})();